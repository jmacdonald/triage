- content_for :nav do
  .well.context-menu
    %ul.nav.nav-list
      %li.nav-header Modify
      - if can? :edit, @request
        %li
          %a{ href: '#reassign_modal', data: {toggle: 'modal'}}
            %i.icon-share
            Re-assign
      %li
        %a{ href: '#change_status_modal', data: {toggle: 'modal'}}
          %i.icon-info-sign
          Change Status
      %li
        %a{ href: '#edit_details_modal', data: {toggle: 'modal'}}
          %i.icon-pencil
          Edit Details
      %li.nav-header Add
      %li
        %a{ href: '#add_comment_modal', data: {toggle: 'modal'}}
          %i.icon-comment
          Comment
      %li
        %a{ href: '#add_attachment_modal', data: {toggle: 'modal'}}
          %i.icon-file
          Attachment

.request
  .id<
    Request #
    = @request.id
  %h2
    = @request.title
  %dl.dl-horizontal
    %dt Status
    %dd
      %span.label{ class: (label_class @request.status) }
        = @request.status
    %dt System
    %dd 
      = @request.system
    %dt Requested By
    %dd 
      = @request.requester
    %dt Requested On
    %dd 
      = pretty_date @request.created_at
    %dt Assigned To
    %dd 
      = @request.assignee ? @request.assignee : 'Unassigned'
  %h5
    Description
  = @request.description

  %hr

  .comments
    %h4 Comments

    - @request.comments.each_with_index do |comment, index|
      - unless index == 0
        %hr
      .comment
        .row-fluid
          .span1.gravatar
            = gravatar_image_tag comment.user.email, class: 'img-polaroid', gravatar: {size: 32}
          .span11
            %h5
              = pretty_date comment.created_at
              %br
              %small
                = comment.user
            = comment.content

#reassign_modal.modal.hide.fade
  = simple_form_for [@request] do |f|
    .modal-header
      %h3 Re-assign Request
    .modal-body
      = f.association :assignee
    .modal-footer
      %a.btn{href: '#', data: {dismiss: 'modal'}}
        Close
      = f.button :submit, class: 'btn-primary', value: 'Re-Asssign'

#change_status_modal.modal.hide.fade
  = simple_form_for [@request] do |f|
    .modal-header
      %h3 Change Status
    .modal-body
      = f.association :status
    .modal-footer
      %a.btn{href: '#', data: {dismiss: 'modal'}}
        Close
      = f.button :submit, class: 'btn-primary', value: 'Change'

#edit_details_modal.modal.hide.fade
  = simple_form_for [@request] do |f|
    .modal-header
      %h3 Edit Details
    .modal-body
      = f.input :title
      = f.input :description
    .modal-footer
      %a.btn{href: '#', data: {dismiss: 'modal'}}
        Close
      = f.button :submit, class: 'btn-primary', value: 'Edit Details'

#add_comment_modal.modal.hide.fade
  = simple_form_for [@request, @request.comments.new] do |f|
    .modal-header
      %h3 Add Comment
    .modal-body
      = f.input :content, input_html: {rows: 5}, label: false
    .modal-footer
      %a.btn{href: '#', data: {dismiss: 'modal'}}
        Close
      = f.button :submit, class: 'btn-primary', value: 'Add Comment'

#add_attachment_modal.modal.hide.fade
  = simple_form_for [@request, Attachment.new], :html => {:multipart => true}   do |f|
    .modal-header
      %h3 Add Attachment
    .modal-body
      = f.input :title
      = f.input :file
    .modal-footer
      %a.btn{href: '#', data: {dismiss: 'modal'}}
        Close
      = f.button :submit, class: 'btn-primary', value: 'Add Attachment'

- if @request.attachments.count > 0
  - content_for :sidebar do
    .sidebar
      %h5 Attachments
      %ul#attachments
        - @request.attachments.each do |attachment|
          %li
            %i.icon-file
            = link_to attachment.file.url do
              = attachment.title
            .pull-right
              = link_to request_attachment_path(attachment),  { class: 'pull-right', method: 'delete' }  do
                %i.icon-remove
